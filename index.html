<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <script src="./js/bootstrap.min.js"></script>

    <title>ひとりポーカー</title>
</head>
<body>
<div id="app-porker">
    <ul>
        <li>
            <input type="checkbox" id="hand1" value="0" v-model="checkedValues">
            <label for="hand1"> {{ hand[0].mark }} {{ hand[0].num }}</label>
        </li><li>
            <input type="checkbox" id="hand2" value="1" v-model="checkedValues">
            <label for="hand2"> {{ hand[1].mark }} {{ hand[1].num }}</label>
        </li><li>
            <input type="checkbox" id="hand3" value="2" v-model="checkedValues">
            <label for="hand3"> {{ hand[2].mark }} {{ hand[2].num }}</label>
        </li><li>
            <input type="checkbox" id="hand4" value="3" v-model="checkedValues">
            <label for="hand4">{{ hand[3].mark }} {{ hand[3].num }}</label>
        </li><li>
            <input type="checkbox" id="hand5" value="4" v-model="checkedValues">
            <label for="hand5"> {{ hand[4].mark }} {{ hand[4].num }}</label>
        </li>
    </ul>
    <p> 評価: {{ evaluationHand(hand) }}</p>
    <input type="checkbox" id="debug" value="debug" @click="change">
    <label for="debug"> debugや実験 </label>
    <div v-if="debug">
        <p>Checked Values: {{ checkedValues | json }}</p>
        <p> 0から12までの乱数: {{ Math.floor(Math.random() * 13) }} </p>
        <p> makeCard(): {{ makeCard() }}</p>
        <p> makeCard('♠', '14'): {{ makeCard('♠', '14') }}</p>
        <p> evaluationHand(): {{ evaluationHand(hand) }}</p>
        <p> deduplication(hand): {{  deduplication(hand) }}</p>
    </div>
</div>

<script>
    
new Vue({
  el: '#app-porker',
  data: {
      hand:[
      makeCard(),
      makeCard(),
      makeCard(),
      makeCard(),
      makeCard(),
      ],
    checkedValues: [],
    debug: false
  },
  methods: {
    change: function(value) {
      this.debug = value.target.checked
    }
  }
})

    /**
     * カードを生成
     * 
     * *説明* 引数がないと、ランダム
     *        ジョーカーは存在しないことになっている
     * 
     * @param  マークと数値を指定
     * @return カードのマークと数値を返す
     */
    function makeCard (mark, num)
    {
        let marks = ['♠', '◇', '♣', '♡',];
        let max_num = 13;
        let return_string = {mark, num};

        if (mark === undefined && num === undefined) {
            return_string.mark = marks[Math.floor(Math.random() * marks.length)];
            return_string.num = String(Math.floor(Math.random() * max_num)+1);
        } else {
            return_string = {mark: mark, num: num};
        }

        return return_string;
    }

    /**
     * 手札を評価する
     * *説明*
     * 
     * @param 1-5
     * @return 揃った役の名前を表示
     */
    function evaluationHand(hand)
    {
        // 手札が5枚なければ役は出来ない
        if (false === (5 === hand.length)) {
            return "役なし";
        }
        // 重複判定する
        let d = deduplication(hand);

        // 重複しない数字が２つならフォア・カードかフルハウス
        if (2 === d.nums) { 
            return "フォア・カードorフルハウス"
        }
        // 重複しないマークがひとつならフラッシュ
        if (1 === d.marks) { 
            return "フラッシュ"
        }
        // 重複しない数字が３つならスリーカードかツウ・ペア
        if (3 === d.nums) {
            return "スリーカードorツウ・ペア";
        }
        // 重複しない数字が１つならワンペア
        if (4 === d.nums) {
            return "ワンペア";
        }
        return "役なし";
    }

    /**
     * 手札から数字とマークの重複を排除した個数
     * 
     * @param array card
     * @return object
     */
    function deduplication(hand)
    {
        let nums = [];
        let marks = [];
        for (let i in hand) {
            nums.push(hand[i].num);
            marks.push(hand[i].mark);
        }
        // 重複を排除
        nums = Array.from(new Set(nums));
        marks = Array.from(new Set(marks));

        return {marks: marks.length, nums: nums.length};
    }

</script>
</body>
</html>