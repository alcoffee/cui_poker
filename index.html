<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <script src="./js/bootstrap.min.js"></script>
    <script src="./lib/vue.min.js"></script>

    <title>ひとりポーカー</title>
</head>
<body>
<div id="app-porker">
    <div>
        <div v-for="(hand, index) in hands" style="float: left; padding: 10px">
            <input type="checkbox" id="hand" v-model="checkedValues"
                :value="index" :id="'hand'+index">
            <label style="width: 120px; height: 200px; background-color: lemonchiffon; border-radius: 7px"
                :style="{ border: checkedValues.includes(index)?
                borderDanger : borderPrimary }" :for="'hand' + index" >
                {{ hand.mark }} {{ hand.num }}
            </label>
        </div>
    </div>
    
    <div style="clear: both;">
        <p> 評価: {{ evaluationHands(hands) }}</p>
        <button class="btn btn-primary" @click="reload">選択した手札を交換</button>
        <!-- <button class="button" @click="checkedReset">ボタン</button> -->
        <hr>
        <input type="checkbox" id="debug" value="debug" @click="change">
        <label for="debug"> debugや実験 </label>
        <div v-if="debug">
            <p> Checked Values: {{ hands }} </p>
            <p> Checked Values: {{ checkedValues | json }} </p>
            <p> 0から12までの乱数: {{ Math.floor(Math.random() * 13) }} </p>
            <p> makeCard(): {{ makeCard() }}</p>
            <p> makeCard('♠', '14'): {{ makeCard('♠', '14') }}</p>
            <p> evaluationHands(): {{ evaluationHands(hands) }}</p>
            <p> deduplication(hands): {{ deduplication(hands) }}</p>
        </div>
    </div>
</div>

<script>
    new Vue({
        el: '#app-porker',
        data:
        {
            hands:[
            makeCard(),
            makeCard(),
            makeCard(),
            makeCard(),
            makeCard(),
            ],
            checkedValues: [],
            debug: false,
            borderPrimary: '2px solid gray',
            borderDanger: '2px solid blue',
        },
        methods:
        {
            change: function(value)
            {
                this.debug = !value.target.checked
            },
            /**
             * 引き直し
             */
            reload: function()
            {
                let len = this.checkedValues.length;
                for (var i=0; i <= len+1; i++) {
                    let index = this.checkedValues[i];
                    this.$set(this.hands, index, makeCard());
                }
                this.checkedReset();
                evaluationHands(this.hands);
            },
            checkedReset: function()
            {
                let len = this.checkedValues.length;
                for (let i=0; i<=len; i++) {
                    this.checkedValues.pop();
                }
            }
        }
    })

    /**
     * カードを生成
     * 
     * *説明* 引数がないと、ランダム
     *        ジョーカーは存在しないことになっている
     * 
     * @param マークと数値を指定
     * @return カードのマークと数値を返す
     */
    function makeCard (mark, num)
    {
        let marks = ['♠', '◇', '♣', '♡',];
        let max_num = 13;
        let return_string = {mark, num};

        if (mark === undefined && num === undefined) {
            return_string.mark = marks[Math.floor(Math.random() * marks.length)];
            return_string.num = String(Math.floor(Math.random() * max_num)+1);
        } else {
            return_string = {mark: mark, num: num};
        }

        return return_string;
    }

    function relaod(hands, values)
    {
        for (var i=0; values.length<=i; i++) {
            let index = values[i];
            hands[index] = makeCard();
        }
        return values;
    }

    /**
     * 手札を評価する
     * *説明*
     * 
     * @param 1-5
     * @return 揃った役の名前を表示
     */
    function evaluationHands(hands)
    {
        // 手札が5枚なければ役は出来ない
        if (false === (5 === hands.length)) {
            return "役なし";
        }
        // 重複を判定する
        let d = deduplication(hands);

        // 重複しない数字が２つならフォア・カードかフルハウス
        if (2 === d.nums) { 
            return "フォア・カードorフルハウス"
        }
        // 重複しないマークがひとつならフラッシュ
        if (1 === d.marks) { 
            return "フラッシュ"
        }
        // 重複しない数字が３つならスリーカードかツウ・ペア
        if (3 === d.nums) {
            return "スリーカードorツウ・ペア";
        }
        // 重複しない数字が１つならワンペア
        if (4 === d.nums) {
            return "ワンペア";
        }
        return "役なし";
    }

    /**
     * 手札から数字とマークの重複を排除した個数
     * 
     * @param array hands
     * @return object
     */
    function deduplication(hands)
    {
        let nums = [];
        let marks = [];
        let len = hands.length;
        for (let i=0; i<len; i++) {
            nums.push(hands[i].num);
            marks.push(hands[i].mark);
        }
        // 重複を排除
        nums = Array.from(new Set(nums));
        marks = Array.from(new Set(marks));

        return {marks: marks.length, nums: nums.length};
    }

    /**
     *  ストレートかどうかを判定し、
     *  ストレートであればその強さを返す
     *  
     *  @param array hands
     *  @return int
     */
    function isStraight(hands)
    {
        let nums = [];
        let len = hands.length;
        for (let i=0; i <= len; i++) {
            nums.push(hands[i].num);
        }
        for (let i=0; i <= len; i++) {
            for (let j=0; j <= len; i++) {
                console.log('a');
            }
        }
    }
</script>
</body>
</html>